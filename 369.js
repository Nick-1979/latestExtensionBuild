(()=>{var e,a,n={18983:()=>{},53260:()=>{},16865:(e,a,n)=>{"use strict";var s=n(160),t=n(60576),o=n(38090),r=n(45951),i=n(91801),c=n(95292),l=n(48801),d=n(36631),u=n(64021),f=n(51330),p=n(57928);const h=new Uint8Array(32),m=(0,u.d)("modl");function b(e,a,n){return e.registry.createType("AccountId32",(0,f.e)(m,e.consts.nominationPools.palletId.toU8a(),new Uint8Array([n]),(0,p.a)(a,{bitLength:32}),h)).toString()}const g=(0,d.Z)((function(e,a){return{rewardId:b(e,a,1),stashId:b(e,a,0)}}));var v=n(70052);function w(e,a={},n){return v.ZP.get(e,{data:a,...n})}const y="0xfc41b9bd8ef8fe53d58c7ea67c794c7ec9a73daf05e6d54b14ff6342c99ba64c",k="0x48239ef607d7928874027a43a67689209727dfb3d3dc5e5b03a39bdc2eda771a",D="0x68d56f15f85d3136970ec16946040bc1752654e906147f7e43e9d539d7c3de2f",S=[{genesisHash:"0x91b171bb158e2d3848fa23a9f1c25182fb8e20313b2c1eb49219da7a70ce90c3",name:"Polkadot",priceID:"polkadot"},{genesisHash:"0xb0a8d493285c2df73290dfb7e61f870f17b41801197a149ca93654499ea3dafe",name:"Kusama",priceID:"kusama"},{genesisHash:y,name:"Acala",priceID:"acala"},{genesisHash:"0xe143f23803ac50e8f6f8e62695d1ce9e4e1d68aa36c1cd2cfd15340213f3423e",name:"Westend",priceID:""},{genesisHash:"0x9eb76c5184c4ab8679d2d5d819fdf90b9c001403e9e17da2e14b6d8aec4029c6",name:"Astar",priceID:"astar"},{genesisHash:"0xafdc188f45c71dacbaa0b62e16a91f726c7b8699a9748cdf715459de6b7f366d",name:"HydraDX",priceID:"hydradx"},{genesisHash:"0xbaf5aabe40646d11f0ee8abbdc64f4a4b7674925cba08e4a05ff9ebed6e2126b",name:"Karura",priceID:"karura"},{genesisHash:"0x67f9723393ef76214df0118c34bbbd3dbebc8ed46a10973a8c969d48fe7598c9",name:"WestendAssetHub",priceID:""}],P=["hydradx","karura","liquid-staking-dot","acala-dollar-acala","astar","kusama","acala","polkadot","tether","usd-coin"];async function I(e,a){let n;const r=e.map((e=>{const r=new t.U(e.value);return n=a?new o.G((0,s.Y)({provider:r})).isReady:o.G.create({provider:r}),{connection:n,wsProvider:r}})),i=await Promise.any(r.map((e=>e.connection)));return{connections:r,fastApi:i}}function H(e){e.forEach((e=>e.wsProvider.disconnect().catch(A)))}function A(e){console.error("Error:",e)}function x(e){return e.split(/(?=[A-Z])/).join(" ").trim()}function O(e){var a;const n=i.uG.find((a=>a.genesisHash[0]===e));return null!=n&&null!=(a=n.symbols)&&a.length?n.symbols[0]:void 0}function C(e,a,n,s,t,o,r){o.push(a.derive.balances.all(e).then((e=>{var a,o;const i=e.freeBalance.add(e.reservedBalance),c=null!=(a=null==(o=t.prices[s])?void 0:o.usd)?a:0,l=(d=s).charAt(0).toUpperCase()+d.slice(1)+"AssetHub";var d;r.push({balances:String(i),chain:x(l),decimal:U(n),genesisHash:n,price:c,token:O(n)})})))}function U(e){var a;const n=i.uG.find((a=>a.genesisHash[0]===e));return null!=n&&null!=(a=n.decimals)&&a.length?n.decimals[0]:void 0}async function E(e){console.log(`get assets on other chains called for ${e}`);const a=(0,r.Rf)(),n=[],s=await async function(e,a="usd"){try{const n=e.map((e=>e.replace("westendassethub","westend").replace("kusamaassethub","kusama").replace("polkadotassethub","polkadot").replace("westend asset hub","westend").replace("kusama asset hub","kusama").replace("polkadot asset hub","polkadot").replace("westmint","westend").replace("statemine","kusama").replace("statemint","polkadot"))),s=[...new Set(n)];console.log(" getting prices for:",s);const t=await w(`https://api.coingecko.com/api/v3/simple/price?ids=${s}&vs_currencies=${a}`,{});if(e.includes("pendulum")){const e=await w("https://min-api.cryptocompare.com/data/price?fsym=PEN&tsyms=USD",{});null!=e&&e.USD&&(t.pendulum={usd:e.USD})}return t.westend={usd:0},console.log("Prices:",t),{date:Date.now(),prices:t}}catch(e){return console.log("error while fetching prices:",e),null}}(P);if(null===s)throw new Error("Failed to fetch prices");const t=[],o=await async function(e,a,n,s){const t=(0,r.Rf)().filter((e=>e.info&&"acala"===e.info.toLowerCase())).filter((e=>e.value&&e.value.startsWith("wss://"))).slice(0,5),{connections:o,fastApi:i}=await I(t,!0),c=["LDOT","ACA","DOT","AUSD"];for(const t of c)n.push(i.query.tokens.accounts(e,{Token:t}).then((e=>{var n,o;const r=e.free.add(e.reserved),i="AUSD"===t?"acala-dollar-acala":"LDOT"===t?"liquid-staking-dot":void 0,c=i?null==(n=s.prices[i])?void 0:n.usd:null==(o=s.prices.acala)?void 0:o.usd,l=r.isZero();a.push({balances:String(r),chain:x("Acala"),decimal:U(y),genesisHash:y,price:c,token:t}),!l&&postMessage(JSON.stringify(a))})));return o}(e,n,t,s),i=await async function(e,a,n,s){const t=[{name:"Tether USD",id:1984,priceID:"tether"},{name:"USD Coin",id:1337,priceID:"usd-coin"}],o=(0,r.Rf)().filter((e=>e.info&&"polkadotassethub"===e.info.toLowerCase())).filter((e=>e.value&&e.value.startsWith("wss://"))),{connections:i,fastApi:l}=await I(o,!1);C(e,l,D,"polkadot",s,n,a);for(const o of t)n.push(Promise.all([l.query.assets.account(o.id,e),l.query.assets.metadata(o.id)]).then((([e,n])=>{var t;const r=n.decimals.toNumber(),i=n.symbol.toHuman(),l=e.isNone?c.nw:e.unwrap().balance,d=o.priceID?null==(t=s.prices[o.priceID])?void 0:t.usd:1,u=l.isZero();a.push({balances:String(l),chain:x("PolkadotAssetHub"),decimal:r,genesisHash:D,price:d,token:i}),!u&&postMessage(JSON.stringify(a))})));return i}(e,n,t,s),d=await async function(e,a,n,s){const t=[{name:"Polkadot",id:14,priceID:"polkadot"},{name:"Tether USD",id:19840,priceID:"tether"},{name:"USD Coin",id:10,priceID:"usd-coin"}],o=(0,r.Rf)().filter((e=>e.info&&"kusamaassethub"===e.info.toLowerCase())).filter((e=>e.value&&e.value.startsWith("wss://"))),{connections:i,fastApi:l}=await I(o,!1);C(e,l,k,"kusama",s,n,a);for(const o of t)n.push(Promise.all([l.query.assets.account(o.id,e),l.query.assets.metadata(o.id)]).then((([e,n])=>{var t;const r=n.decimals.toNumber(),i=n.symbol.toHuman(),l=e.isNone?c.nw:e.unwrap().balance,d=o.priceID?null==(t=s.prices[o.priceID])?void 0:t.usd:1,u=l.isZero();a.push({balances:String(l),chain:x("KusamaAssetHub"),decimal:r,genesisHash:k,price:d,token:i}),!u&&postMessage(JSON.stringify(a))})));return i}(e,n,t,s),u=S.map((t=>async function(e,a,n){const s=n.filter((a=>a.info&&a.info.toLowerCase()===e.toLowerCase())).filter((e=>e.value&&e.value.startsWith("wss://")));console.log(`Connecting to endpoints for ${e}`);const{connections:t,fastApi:o}=await I(s,!1);if(o.isConnected&&o.derive.balances){const e=await o.derive.balances.all(a),n=e.freeBalance.add(e.reservedBalance);return o.query.nominationPools?await async function(e,a,n,s){var t,o,r;const i=await e.query.nominationPools.poolMembers(a),d=i&&i.unwrapOr(void 0);if(!d)return s.forEach((e=>e.wsProvider.disconnect().catch(A))),n;const u=d.poolId,f=u&&g(e,u);if(!f)return s.forEach((e=>e.wsProvider.disconnect().catch(A))),n;const[p,h,m]=await Promise.all([e.query.nominationPools.bondedPools(u),e.derive.staking.account(f.stashId),e.call.nominationPoolsApi.pendingRewards(a)]),b=d.points.isZero()?c.nw:new l(String(d.points)).mul(new l(String(h.stakingLedger.active))).div(new l(String(null!=(t=null==(o=p.unwrap())?void 0:o.points)?t:c.If))),v=m;let w=c.nw;return null==d||null==(r=d.unbondingEras)||r.forEach((e=>{w=w.add(e)})),s.forEach((e=>e.wsProvider.disconnect().catch(A))),n.add(b.add(v).add(w))}(o,a,n,t):(H(t),n)}}(t.name,e,a).then((e=>{var a,o;const r=e.isZero(),i=t.priceID&&null!=(a=null==(o=s.prices[t.priceID])?void 0:o.usd)?a:0;n.push({balances:String(e),chain:x(t.name),decimal:U(t.genesisHash),genesisHash:t.genesisHash,price:i,token:O(t.genesisHash)}),!r&&postMessage(JSON.stringify(n))})).catch((e=>{console.error(`Error fetching balances for ${t.name}:`,e)}))));t.push(...u),await Promise.all(t).finally((()=>(H([...o,...i,...d]),n.every((e=>"0"===e.balances))?postMessage("null"):postMessage("Done"))))}onmessage=async e=>{const{accountAddress:a}=e.data;let n=1;for(console.log(`tryCount fetch assets on other chains: ${n}`);n>=1&&n<=5;){try{await E(a),n=0}catch(e){console.error(`Error while fetching assets on other chains, ${5-n} times to retry`,e),5===n&&postMessage("Done")}n++}}}},s={};function t(e){var a=s[e];if(void 0!==a)return a.exports;var o=s[e]={id:e,loaded:!1,exports:{}};return n[e].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}t.m=n,t.x=()=>{var e=t.O(void 0,[89,168],(()=>t(16865)));return t.O(e)},e=[],t.O=(a,n,s,o)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,s,o]=e[d],i=!0,c=0;c<n.length;c++)(!1&o||r>=o)&&Object.keys(t.O).every((e=>t.O[e](n[c])))?n.splice(c--,1):(i=!1,o<r&&(r=o));if(i){e.splice(d--,1);var l=s();void 0!==l&&(a=l)}}return a}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,s,o]},t.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},t.d=(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},t.f={},t.e=e=>Promise.all(Object.keys(t.f).reduce(((a,n)=>(t.f[n](e,a),a)),[])),t.u=e=>e+".js",t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var a=t.g.document;if(!e&&a&&(a.currentScript&&(e=a.currentScript.src),!e)){var n=a.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),(()=>{var e={369:1};t.f.i=(a,n)=>{e[a]||importScripts(t.p+t.u(a))};var a=("undefined"!=typeof self?self:this).webpackChunk_polkadot_extension=("undefined"!=typeof self?self:this).webpackChunk_polkadot_extension||[],n=a.push.bind(a);a.push=a=>{var[s,o,r]=a;for(var i in o)t.o(o,i)&&(t.m[i]=o[i]);for(r&&r(t);s.length;)e[s.pop()]=1;n(a)}})(),a=t.x,t.x=()=>Promise.all([t.e(89),t.e(168)]).then(a),t.x()})();